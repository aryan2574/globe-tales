<div class="profile-container">
    <h2>Profile Information</h2>

    <div class="gamification-stats" *ngIf="user">
        <div class="stat-item">
            <i class="fas fa-star"></i>
            <label>Level</label>
            <span>{{ user.level || 'Beginner' }}</span>
        </div>
        <div class="stat-item">
            <i class="fas fa-gem"></i>
            <label>Experience</label>
            <span>{{ user.experiencePoints || 0 }} XP</span>
        </div>
    </div>

    <form [formGroup]="profileForm" (ngSubmit)="onSubmit()" class="profile-form">
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" formControlName="username" placeholder="Enter your username" />
        </div>
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" formControlName="email" placeholder="Enter your email" readonly />
        </div>
        <div class="form-group">
            <label for="location">Location</label>
            <ng-container *ngIf="locationChecked">
                <ng-container *ngIf="
            user && user.latitude != null && user.longitude != null;
            else noLocation
          ">
                    <div class="profile-map-box">
                        <app-map [latitude]="user.latitude" [longitude]="user.longitude"></app-map>
                    </div>
                    <div style="font-size: 0.95em; color: #555; margin-bottom: 0.5rem;">
                        Lat: {{ user.latitude }}, Lng: {{ user.longitude }}
                    </div>
                    <div class="location-actions">
                        <button type="button" class="btn-set-location" (click)="updateLocation()"
                            [disabled]="updatingLocation">
                            <span *ngIf="!updatingLocation"><i class="fas fa-sync-alt"></i> Update Location</span>
                            <span *ngIf="updatingLocation"><i class="fas fa-spinner fa-spin"></i> Updating...</span>
                        </button>
                    </div>
                </ng-container>
                <ng-template #noLocation>
                    <div class="location-actions">
                        <button type="button" class="btn-set-location" (click)="setLocation()"
                            [disabled]="loadingLocation">
                            <span *ngIf="!loadingLocation"><i class="fas fa-map-marker-alt"></i> Set My Location</span>
                            <span *ngIf="loadingLocation"><i class="fas fa-spinner fa-spin"></i> Setting...</span>
                        </button>
                    </div>
                </ng-template>
            </ng-container>
        </div>
        <div class="profile-actions">
            <button type="submit" class="btn-save" [disabled]="profileForm.invalid">
                Save Changes
            </button>
            <button type="button" class="btn-delete-outline" (click)="onDeleteAccount()">
                <i class="fas fa-trash-alt"></i> Delete Account
            </button>
        </div>
    </form>
</div>