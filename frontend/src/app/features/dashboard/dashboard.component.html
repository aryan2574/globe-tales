<div class="dashboard-container">
    <ng-container *ngIf="!hasLocation">
        <div class="no-location-message">
            <i class="fas fa-map-marker-alt fa-2x"></i>
            <h2>Location is not provided</h2>
            <p>
                We need live location to show nearby places.<br>
                You can set your current location in <b>My Journey / Profile</b> section.
            </p>
        </div>
    </ng-container>
    <ng-container *ngIf="hasLocation">
        <div class="map-section">
            <app-weather-widget class="weather-widget-overlay"></app-weather-widget>
            <app-map *ngIf="hasLocation" [latitude]="currentLatitude!" [longitude]="currentLongitude!" [places]="places"
                [selectedPlace]="selectedPlace" [routeGeometry]="routeInfo?.geometry"></app-map>
            <div class="route-controls" *ngIf="selectedPlace">
                <div class="route-info" *ngIf="routeInfo">
                    <div class="info-item">
                        <i class="fas fa-road"></i>
                        <span>{{ routeInfo.distance | distance }}</span>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <span>{{ routeInfo.duration | duration }}</span>
                    </div>
                </div>
                <div class="transport-modes">
                    <button class="transport-btn" [class.active]="transportMode === 'driving-car'"
                        (click)="getRoute('driving-car')">
                        <i class="fas fa-car"></i>
                    </button>
                    <button class="transport-btn" [class.active]="transportMode === 'foot-walking'"
                        (click)="getRoute('foot-walking')">
                        <i class="fas fa-walking"></i>
                    </button>
                    <button class="transport-btn" [class.active]="transportMode === 'cycling-regular'"
                        (click)="getRoute('cycling-regular')">
                        <i class="fas fa-bicycle"></i>
                    </button>
                </div>
                <button class="clear-route-btn" (click)="clearRoute()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div class="places-panel">
            <div class="search-section">
                <h2><i class="fas fa-map-marker-alt"></i> Nearby Places</h2>
                <div class="filter-controls">
                    <select [(ngModel)]="selectedType" (change)="onTypeChange()">
                        <option value="">All Types</option>
                        <option value="hotel"><i class="fas fa-hotel"></i> Hotels</option>
                        <option value="attraction">
                            <i class="fas fa-landmark"></i> Attractions
                        </option>
                        <option value="museum">
                            <i class="fas fa-university"></i> Museums
                        </option>
                        <option value="restaurant">
                            <i class="fas fa-utensils"></i> Restaurants
                        </option>
                        <option value="viewpoint">
                            <i class="fas fa-mountain"></i> Viewpoints
                        </option>
                    </select>
                    <div class="radius-control">
                        <i class="fas fa-circle-notch"></i>
                        <input type="range" [(ngModel)]="searchRadius" min="500" max="5000" step="500"
                            (change)="onRadiusChange()" />
                        <span>{{ searchRadius }}m</span>
                    </div>
                    <button class="update-location-btn" (click)="updateLocation()">
                        <i class="fas fa-sync-alt"></i> Update Location
                    </button>
                </div>
            </div>

            <div class="places-list">
                <div *ngIf="loading" class="loading">
                    <i class="fas fa-spinner fa-spin"></i> Loading places...
                </div>
                <div *ngIf="error" class="error">
                    <i class="fas fa-exclamation-circle"></i> {{ error }}
                </div>

                <div *ngIf="!loading && !error && places.length === 0" class="no-places">
                    <i class="fas fa-search"></i> No places found in this area
                </div>

                <div *ngFor="let place of places" class="place-card" [class.selected]="place === selectedPlace"
                    (click)="selectPlace(place)">
                    <h3>
                        <i class="fas" [ngClass]="{
              'fa-hotel': place.type === 'hotel',
              'fa-landmark': place.type === 'attraction',
              'fa-university': place.type === 'museum',
              'fa-utensils': place.type === 'restaurant',
              'fa-mountain': place.type === 'viewpoint',
              'fa-map-marker-alt': ![
                'hotel',
                'attraction',
                'museum',
                'restaurant',
                'viewpoint'
              ].includes(place.type)
            }"></i>
                        {{ place.name }}
                    </h3>
                    <p class="place-type">{{ place.type }}</p>
                    <p *ngIf="place.tags['description']" class="place-description">
                        {{ place.tags['description'] }}
                    </p>
                    <div class="place-actions">
                        <button class="btn-small" [ngClass]="{'saved': isPlaceSaved(place)}"
                            (click)="saveToFavorites(place); $event.stopPropagation();">
                            <i *ngIf="savingFavouriteId === place.id" class="fas fa-spinner fa-spin"
                                style="margin-right:4px;"></i>
                            <i *ngIf="savingFavouriteId !== place.id" class="fas"
                                [ngClass]="isPlaceSaved(place) ? 'fa-heart' : 'fa-heart'" style="margin-right:4px;"></i>
                            {{ savingFavouriteId === place.id ? 'Saving...' : (isPlaceSaved(place) ? 'Saved' : 'Save')
                            }}
                        </button>
                        <button class="btn-small" [ngClass]="{'visited': isPlaceVisited(place)}"
                            (click)="markAsVisited(place); $event.stopPropagation();">
                            <i *ngIf="savingVisitedId === place.id" class="fas fa-spinner fa-spin"
                                style="margin-right:4px;"></i>
                            <i *ngIf="savingVisitedId !== place.id" class="fas"
                                [ngClass]="isPlaceVisited(place) ? 'fa-check-circle' : 'fa-check'"
                                style="margin-right:4px;"></i>
                            {{ savingVisitedId === place.id ? 'Visiting...' : (isPlaceVisited(place) ? 'Visited' : 'Mark
                            as Visited') }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>
</div>